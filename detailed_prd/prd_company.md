# ClockBox - PRD 세부 문서 : 회사설정 (Company Settings)

## 1. 개요 (Overview)
ClockBox의 회사 설정(Company Settings) 기능은 회사 단위 정책, 권한, 보안, 결제, 외부 연동을 관리한다.

### 목적
- 회사 운영 환경 중앙 관리  
- 보안, 결제, 연동의 통합 관리  

---

## 2. 사용자 시나리오 (User Flow)

### 시나리오 A: 회사 기본 정보 설정
1. **회사 프로필 설정**
   - 관리자가 회사설정 > 프로필 진입
   - 회사명, 업종, 주소, 연락처 등 기본 정보 입력
   - 회사 로고 업로드 및 브랜딩 설정
   - 근무 시간, 휴일 정책 등 기본 운영 규칙 설정
2. **조직 구조 설정**
   - 부서/팀 구조 생성 및 관리
   - 직급/역할 체계 정의
   - 조직도 생성 및 상하 관계 설정

### 시나리오 B: 세부 기능별 정책 설정
1. **근무 및 출퇴근 정책**
   - 출퇴근 방식 설정 (GPS, QR코드, 생체인식 등)
   - 지각/조퇴 기준 시간 설정
   - 야근/휴일근무 승인 정책 설정
   - 휴게시간 정책 및 자동 차감 설정
2. **휴가 및 요청 정책**
   - 연차/병가/특별휴가 규정 설정
   - 휴가 승인 라인 및 자동 승인 규칙 설정
   - 각종 요청(일정변경, 출퇴근수정 등) 승인 절차 설정
3. **급여 및 정산 정책**
   - 급여 계산 기준 및 공제 항목 설정
   - 연장근무 수당 계산 방식 설정
   - 정산 주기 및 급여명세서 발송 방식 설정

### 시나리오 C: 권한 및 보안 관리
1. **사용자 권한 설정**
   - 역할별(관리자/팀장/직원) 접근 권한 매트릭스 설정
   - 메뉴별 접근 가능 여부 세부 설정
   - 데이터 조회 범위 설정 (본인/팀/전체)
   - 승인 권한 위임 및 대리자 설정
2. **보안 정책 적용**
   - 비밀번호 정책 설정 (복잡도, 주기적 변경 등)
   - 2단계 인증(2FA) 활성화
   - IP 접근 제한 설정
   - 로그인 세션 관리 정책 설정

### 시나리오 D: 알림 및 커뮤니케이션 설정
1. **알림 채널 설정**
   - 푸시 알림, 이메일, SMS 등 채널별 활성화
   - 카카오톡, Slack, Teams 등 외부 메신저 연동
   - 알림 발송 시간대 및 빈도 설정
2. **메시지 템플릿 관리**
   - 공지사항, 급여명세서 등 메시지 템플릿 편집
   - 자동 발송 규칙 및 조건 설정
   - 수신 대상 그룹 관리

### 시나리오 E: 결제 및 구독 관리
1. **요금제 선택**
   - 회사 규모에 맞는 요금제 선택
   - 기능별 옵션 추가/제거
   - 사용자 수 증감에 따른 요금 조정
2. **결제 수단 관리**
   - 신용카드, 계좌이체 등 결제 방법 등록
   - 자동 결제 설정 및 결제일 변경
   - 결제 내역 조회 및 영수증 다운로드
   - 결제 실패 시 대체 결제 수단 설정  

---

## 3. 기능 정의 (Feature Definition)

### 기본 회사 관리
- **[FR-COM-001] 회사 프로필 및 브랜딩 관리**
  - 회사 기본 정보 (회사명, 업종, 주소, 연락처) 관리
  - 회사 로고 및 브랜드 컬러 설정
  - 조직도 생성 및 부서/팀 구조 관리
  - 직급 체계 및 역할 정의

- **[FR-COM-002] 근태 운영 정책 관리**
  - 근무 시간 및 휴게 시간 정책 설정
  - 출퇴근 방식 선택 (GPS, QR코드, 생체인식 등)
  - 지각/조퇴 기준 및 처리 방식 설정
  - 연장근무 및 휴일근무 승인 정책

- **[FR-COM-003] 휴가 및 신청 정책 관리**
  - 연차/병가/특별휴가 종류 및 규정 설정
  - 휴가 승인 라인 및 자동 승인 규칙
  - 각종 신청 (일정변경, 출퇴근수정 등) 승인 프로세스
  - 신청 템플릿 및 필수 정보 설정

### 권한 및 보안 관리
- **[FR-COM-004] 사용자 권한 관리 시스템**
  - 역할 기반 접근 제어 (RBAC) 구현
  - 메뉴별/기능별 세부 권한 매트릭스
  - 데이터 조회 범위 제한 (본인/팀/부서/전체)
  - 권한 위임 및 임시 대리자 지정

- **[FR-COM-005] 보안 정책 및 인증 관리**
  - 비밀번호 복잡도 및 변경 주기 정책
  - 2단계 인증(2FA) 설정 및 관리
  - IP 화이트리스트 및 접근 제한
  - 세션 타임아웃 및 동시 로그인 제한
  - 로그인 시도 제한 및 계정 잠금 정책

### 커뮤니케이션 및 알림
- **[FR-COM-006] 통합 알림 시스템 관리**
  - 다중 채널 알림 설정 (푸시, 이메일, SMS)
  - 알림 발송 시간대 및 빈도 제한
  - 사용자별/부서별 알림 선호도 설정
  - 긴급 알림 및 에스컬레이션 규칙

- **[FR-COM-007] 외부 메신저 및 플랫폼 연동**
  - 카카오톡 비즈니스, Slack, Microsoft Teams 연동
  - 웹훅 기반 실시간 알림 전송
  - 외부 플랫폼 연동 상태 모니터링
  - API 키 및 연동 토큰 보안 관리

### 결제 및 구독 관리
- **[FR-COM-008] 구독 요금제 및 결제 관리**
  - 요금제별 기능 제한 및 사용자 수 관리
  - 자동 결제 및 결제 실패 처리
  - 결제 내역 조회 및 세금계산서 발행
  - 요금제 변경 및 비례 계산

- **[FR-COM-009] 사용량 모니터링 및 과금**
  - 실시간 사용자 수 및 기능 사용량 추적
  - 초과 사용 시 자동 과금 또는 기능 제한
  - 사용 통계 및 비용 분석 리포트
  - 예산 설정 및 사용량 알림

### 시스템 관리 및 연동
- **[FR-COM-010] ERP 및 HR 시스템 연동**
  - SAP, 더존, 영림원 등 주요 ERP 시스템 연동
  - 인사정보 양방향 동기화
  - 급여 데이터 자동 연동
  - API 기반 실시간 데이터 교환

- **[FR-COM-011] 데이터 백업 및 복구 관리**
  - 자동 백업 스케줄 설정
  - 백업 데이터 검증 및 복구 테스트
  - 데이터 보관 정책 및 삭제 규칙
  - 재해 복구 계획 및 절차

### 컴플라이언스 및 감사
- **[FR-COM-012] 감사 로그 및 추적 관리**
  - 모든 사용자 활동 로그 기록
  - 중요 설정 변경 이력 추적
  - 감사 보고서 자동 생성
  - 로그 보관 정책 및 검색 기능

- **[FR-COM-013] 법규 준수 및 정책 관리**
  - 근로기준법 등 관련 법규 자동 체크
  - 개인정보보호법 준수 설정
  - 데이터 처리 동의 관리
  - 규정 변경 시 자동 알림 및 업데이트  

---

## 4. UI/UX 요구사항
- 회사 프로필 화면: 회사명, 업종, 로고, 기본정보  
- 권한 관리: 역할-기능 매트릭스 UI  
- 결제 관리: 요금제 선택, 결제수단 등록, 영수증 다운로드  
- 보안 관리: 2FA, 접근제어 토글  

---

## 5. 비즈니스 규칙
- 최소 1명 이상의 관리자 필요  
- 권한 체계는 관리자/승인자/직원 3단계 이상 유지  
- 결제는 선불제, 월 단위 과금  
- 결제 실패 시 7일 유예 후 서비스 제한  

---

## 6. 데이터 모델링 (초안)
### company_settings 테이블
| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| id | PK | 설정 ID |
| company_id | FK(companies.id) | 회사 |
| key | string | 설정 키 |
| value | string | 설정 값 |
| updated_at | datetime | 수정일 |

### subscriptions 테이블
| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| id | PK | 구독 ID |
| company_id | FK(companies.id) | 회사 |
| plan | enum(basic, standard, enterprise) | 요금제 |
| status | enum(active, expired, failed) | 상태 |
| started_at | datetime | 시작일 |
| expired_at | datetime | 종료일 |

---

## 7. 알림 및 연동
- 결제 성공/실패 시 관리자 알림  
- 요금제 만료 7일 전 알림 발송  
- ERP/Slack/MS Teams/카카오워크 연동 지원  

---

## 8. 예외 및 에러 처리
| 케이스 | 조건 | 시스템 동작 | 사용자 메시지 |
|--------|------|------------|--------------|
| 결제 실패 | 카드 오류 | 유예 기간 부여 | “결제가 실패했습니다. 7일 이내 재결제 해주세요.” |
| 권한 없는 접근 | 미승인자 접근 | 차단 | “접근 권한이 없습니다.” |
| 설정 저장 실패 | DB 오류 | 재시도 요청 | “설정 저장 중 오류가 발생했습니다.” |

---

## 9. 연관성 (Dependency & Integration)
- **계정 (prd_account.md)**: 인증/언어 정책 연동  
- **메시지 (prd_message.md)**: 알림 정책 관리  
- **전자계약 (prd_contract.md)**: 계약 보관 정책 관리  
- **정산 (prd_payroll.md)**: 요금제/결제 데이터 반영  

---

## 10. 성공 지표 (KPI)
- 권한 설정 반영 오류율 ≤ 1%  
- 결제 성공률 ≥ 98%  
- 보안정책 적용률 ≥ 95%  
- 알림 전송 성공률 ≥ 99%  
