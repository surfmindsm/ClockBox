# ClockBox - PRD 세부 문서 : 회사설정 (Company Settings)

## 1. 개요 (Overview)
ClockBox의 회사 설정(Company Settings) 기능은 회사 단위 정책, 권한, 보안, 결제, 외부 연동을 관리한다.

### 목적
- 회사 운영 환경 중앙 관리  
- 보안, 결제, 연동의 통합 관리  

---

## 2. 사용자 시나리오 (User Flow)

### 시나리오 A: 권한 설정
1. 관리자가 회사 설정 > 권한 관리 진입  
2. 역할별 접근 권한 세부 설정  
3. 저장 시 시스템 전체 반영  

### 시나리오 B: 결제 관리
1. 관리자가 결제 수단 등록  
2. 요금제 선택 → 구독 진행  
3. 결제 내역/영수증 다운로드  

### 시나리오 C: 보안 정책 적용
1. 관리자가 2FA 활성화 설정  
2. 직원에게 즉시 적용  
3. 로그인 시 2FA 검증 진행  

---

## 3. 기능 정의 (Feature Definition)
- **[FR-COM-001] 회사 프로필 관리**  
- **[FR-COM-002] 권한/역할 관리**  
- **[FR-COM-003] 알림 정책 관리**  
- **[FR-COM-004] 보안 정책 (2FA, 접근제어, 감사로그)**  
- **[FR-COM-005] 결제/구독 관리 (요금제, 결제 수단)**  
- **[FR-COM-006] 외부 연동 (ERP, Slack, MS Teams, 카카오워크 등)**  

---

## 4. UI/UX 요구사항
- 회사 프로필 화면: 회사명, 업종, 로고, 기본정보  
- 권한 관리: 역할-기능 매트릭스 UI  
- 결제 관리: 요금제 선택, 결제수단 등록, 영수증 다운로드  
- 보안 관리: 2FA, 접근제어 토글  

---

## 5. 비즈니스 규칙
- 최소 1명 이상의 관리자 필요  
- 권한 체계는 관리자/승인자/직원 3단계 이상 유지  
- 결제는 선불제, 월 단위 과금  
- 결제 실패 시 7일 유예 후 서비스 제한  

---

## 6. 데이터 모델링 (초안)
### company_settings 테이블
| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| id | PK | 설정 ID |
| company_id | FK(companies.id) | 회사 |
| key | string | 설정 키 |
| value | string | 설정 값 |
| updated_at | datetime | 수정일 |

### subscriptions 테이블
| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| id | PK | 구독 ID |
| company_id | FK(companies.id) | 회사 |
| plan | enum(basic, standard, enterprise) | 요금제 |
| status | enum(active, expired, failed) | 상태 |
| started_at | datetime | 시작일 |
| expired_at | datetime | 종료일 |

---

## 7. 알림 및 연동
- 결제 성공/실패 시 관리자 알림  
- 요금제 만료 7일 전 알림 발송  
- ERP/Slack/MS Teams/카카오워크 연동 지원  

---

## 8. 예외 및 에러 처리
| 케이스 | 조건 | 시스템 동작 | 사용자 메시지 |
|--------|------|------------|--------------|
| 결제 실패 | 카드 오류 | 유예 기간 부여 | “결제가 실패했습니다. 7일 이내 재결제 해주세요.” |
| 권한 없는 접근 | 미승인자 접근 | 차단 | “접근 권한이 없습니다.” |
| 설정 저장 실패 | DB 오류 | 재시도 요청 | “설정 저장 중 오류가 발생했습니다.” |

---

## 9. 연관성 (Dependency & Integration)
- **계정 (prd_account.md)**: 인증/언어 정책 연동  
- **메시지 (prd_message.md)**: 알림 정책 관리  
- **전자계약 (prd_contract.md)**: 계약 보관 정책 관리  
- **정산 (prd_payroll.md)**: 요금제/결제 데이터 반영  

---

## 10. 성공 지표 (KPI)
- 권한 설정 반영 오류율 ≤ 1%  
- 결제 성공률 ≥ 98%  
- 보안정책 적용률 ≥ 95%  
- 알림 전송 성공률 ≥ 99%  
