# ClockBox - PRD 세부 문서 : 출퇴근기록

## 1. 개요 (Overview)
ClockBox의 출퇴근기록(Attendance) 관리 기능을 정의한다.  
GPS/WiFi 인증, 누락 처리, 무일정 근무 지원 포함.

### 목적
- 직원 근무시간의 정확한 기록
- 지각/조퇴/결근 자동 분류
- 법규 준수(주52시간제, 휴게시간)

---

## 2. 사용자 시나리오 (User Flow)
### 시나리오 A: 정상 출퇴근
1. 직원이 앱에서 출근 버튼 클릭
2. GPS/WiFi 인증 후 기록 저장
3. 퇴근 시 동일 절차

### 시나리오 B: 누락 출퇴근
1. 직원이 출근 기록을 누락
2. 관리자에게 누락 요청 → 승인 후 기록 보정

### 시나리오 C: 무일정 근무
1. 일정이 없는 날 출근 시도
2. 관리자 승인 후 근무기록 반영

---

## 3. 기능 정의 (Feature Definition)
- **[FR-ATT-001] 출퇴근 기록**
- **[FR-ATT-002] GPS/WiFi 인증**
- **[FR-ATT-003] 무일정 근무 기록**
- **[FR-ATT-004] 누락 요청/보정**
- **[FR-ATT-005] 지각/조퇴/결근 분류**

---

## 4. UI/UX 요구사항
- 출퇴근 버튼: GPS 인증 후 활성화
- 출퇴근 결과 표시: 성공/실패 메시지
- 누락 요청 UI: 날짜 선택, 사유 입력

---

## 5. 비즈니스 규칙
- 출근 인증은 위치 정확도 ±100m 내에서만 유효
- 동일 시간대 중복 출퇴근 불가
- 무일정 근무는 관리자 승인 필수

---

## 6. 데이터 모델링 (초안)
### attendances 테이블
| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| id | PK | 기록 ID |
| employee_id | FK(employees.id) | 직원 |
| schedule_id | FK(schedules.id) | 근무일정 |
| clock_in | datetime | 출근 시간 |
| clock_out | datetime | 퇴근 시간 |
| status | enum(normal, late, early_leave, absent) | 상태 |
| verified_by | enum(gps, wifi) | 인증 방식 |

---

## 7. 알림 및 연동
- 출퇴근 성공 시 푸시 알림
- 누락 요청 발생 시 관리자 알림
- ERP/급여 시스템 연동

---

## 8. 예외 및 에러 처리
| 케이스 | 조건 | 시스템 동작 | 사용자 메시지 |
|--------|------|------------|--------------|
| 위치 불일치 | GPS 오차 > 100m | 기록 실패 | “출퇴근 위치가 지정된 장소와 다릅니다.” |
| 중복 출퇴근 | 동일 시간대 2회 인증 | 차단 | “이미 출퇴근 기록이 존재합니다.” |
| 무일정 근무 | schedule_id 없음 | 승인 대기 | “무일정 근무 요청이 필요합니다.” |
| 누락 기록 요청 | clock_in/out 없음 | 승인 대기 | “누락된 출퇴근 기록은 관리자가 승인해야 합니다.” |

---

## 9. 연관성 (Dependency & Integration)
- **근무일정 (prd_schedule.md)**: 일정 기반 출퇴근 기록
- **조직/지점 (prd_org.md)**: 위치 인증 연동
- **요청 (prd_request.md)**: 누락 요청 프로세스
- **정산 (prd_payroll.md)**: 근무시간 집계 기반 급여 산출

---

## 10. 성공 지표 (KPI)
- 출퇴근 인증 성공률 ≥ 99%
- 누락 처리 평균 시간 ≤ 1일
