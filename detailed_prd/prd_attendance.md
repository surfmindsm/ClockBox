# ClockBox - PRD 세부 문서 : 출퇴근기록

## 1. 개요 (Overview)
ClockBox의 출퇴근기록(Attendance) 관리 기능을 정의한다.  
GPS/WiFi 인증, 누락 처리, 무일정 근무 지원 포함.

### 목적
- 직원 근무시간의 정확한 기록
- 지각/조퇴/결근 자동 분류
- 법규 준수(주52시간제, 휴게시간)

---

## 2. UI Flow 다이어그램

```mermaid
flowchart TD
    A[앱 실행] --> B{위치 감지}
    B -->|GPS 인증 범위 내| C[출근 버튼 활성화]
    B -->|인증 범위 외| D[위치 오류 메시지]
    C --> E[출근 버튼 클릭]
    E --> F{다중 인증 수행}
    F -->|GPS + WiFi| G[인증 성공]
    F -->|QR코드| H[카메라 스캔]
    H --> G
    F -->|인증 실패| I[오류 알림]
    G --> J[출근 기록 완료]
    J --> K[대시보드로 이동]
    
    L[퇴근 시간] --> M[퇴근 버튼 활성화]
    M --> N[퇴근 버튼 클릭]
    N --> O[근무시간 자동 계산]
    O --> P{초과근무 여부}
    P -->|초과근무 있음| Q[초과근무 사유 입력]
    P -->|정상 근무| R[퇴근 기록 완료]
    Q --> R
    R --> S[오늘 근무 요약 표시]

classDef success fill:#e1f5fe
classDef error fill:#ffebee
classDef process fill:#f3e5f5

class G,J,R,S success
class D,I error  
class F,O,P process
```

### 화면 구성도
```
┌──────────────────────────────────────┐
│  ClockBox - 출퇴근 관리           ⚡ 09:15 │
├──────────────────────────────────────┤
│                                    │
│  현재 위치: 서울본사 (인증 완료)        │
│  ✓ GPS: 인증 완료                     │
│  ✓ WiFi: ClockBox-Office 연결     │
│                                    │
│  ┌──────────────────────────────────┐  │
│  │        출  근             │  │
│  │        09:15             │  │
│  └──────────────────────────────────┘  │
│                                    │
│  근무 상태: 근무 중                    │
│  근무 시간: 0시간 15분                │
│                                    │
│  [오늘 일정] [휴게시간] [기록보정]       │
│                                    │
│  == 최근 7일 기록 ==                 │
│  12/20: 09:00-18:00 (8h) 정상      │
│  12/19: 08:45-18:30 (8h 45m) 연장   │
│  12/18: 09:15-18:00 (7h 45m) 지각   │
│                                    │
└──────────────────────────────────────┘
```

---

## 3. 사용자 시나리오 (User Flow)
### 시나리오 A: 기본 출퇴근 기록

#### A-1: 정상 출근 프로세스
1. **앱 실행 및 위치 확인**
   - 직원이 출근 시간에 ClockBox 앱 실행
   - GPS로 현재 위치 감지 (±100m 오차 범위)
   - 등록된 출근 장소와 비교 검증

2. **인증 수단 선택**
   - GPS 자동 인증 (기본값)
   - WiFi 인증: 사무실 WiFi SSID 감지
   - QR코드 인증: 카메라로 QR코드 스캔

3. **출근 기록 수행**
   - "출근" 버튼 클릭
   - 시스템이 인증 수단 자동 검증
   - 출근 시간 기록 (YYYY-MM-DD HH:mm:ss)

4. **기록 완료 확인**
   - 출근 성공 메시지 표시
   - 현재 근무 상태로 변경
   - 대시보드에 근무 시작 시간 표시

#### A-2: 퇴근 기록 프로세스
1. **퇴근 시간 감지**
   - 정규 근무시간 종료 30분 전 퇴근 준비 알림
   - "퇴근" 버튼 활성화

2. **초과근무 확인**
   - 정규 근무시간 초과 시 초과근무 사유 입력 필드 표시
   - 선택지: 개인사정, 업무요청, 회사지시, 예상초과

3. **퇴근 기록 완료**
   - 총 근무시간 자동 계산
   - 초과근무 시간 별도 집계
   - 오늘 근무 요약 정보 표시

### 시나리오 B: 출퇴근 누락 처리
1. **누락 감지**: 정해진 시간에 출퇴근 기록이 없을 때 시스템에서 감지
2. **관리자 알림**: 누락이 감지되면 해당 직원의 관리자에게 알림 발송
3. **직원 확인**: 직원에게 출퇴근 누락 안내 메시지 발송
4. **수정 요청**: 직원이 출퇴근 기록 수정 요청서 작성
5. **관리자 승인**: 관리자가 요청서 검토 후 승인/반려 결정
6. **기록 반영**: 승인 시 출퇴근 기록에 수정사항 반영

### 시나리오 C: 재택근무 출퇴근
1. **재택근무 모드 선택**: 직원이 재택근무로 출근 모드 변경
2. **재택 출근**: 집에서 출근 버튼 클릭 (위치 확인 생략)
3. **업무 시간 기록**: 재택근무 중 업무시간 자동 기록
4. **중간 보고**: 점심시간 또는 정해진 시간에 업무 상태 간단 체크
5. **재택 퇴근**: 업무 완료 후 퇴근 버튼 클릭
6. **일일 리포트**: 재택근무 완료 후 간단한 업무 보고서 작성

### 시나리오 D: 관리자 출퇴근 현황 관리
1. **출근 현황 조회**: 관리자가 팀원들의 실시간 출근 현황 확인
2. **지각자 확인**: 출근 예정 시간을 넘긴 직원들 목록 조회
3. **결근자 파악**: 출근하지 않은 직원들에 대한 연락 및 확인
4. **근무시간 모니터링**: 팀원들의 일일 근무시간 및 연장근무 현황
5. **월말 정리**: 월말에 팀 전체 출퇴근 통계 및 이상사항 정리
6. **보고서 작성**: 상급자에게 제출할 근태 현황 보고서 생성

### 시나리오 E: 출퇴근 현황 조회 및 관리
1. **출퇴근 기록 조회**: 직원이 본인의 출퇴근 기록을 월별/주별로 조회
2. **근무시간 통계**: 총 근무시간, 연장근무, 지각/조퇴 횟수 확인
3. **출퇴근 수정 요청**: 누락되거나 잘못된 기록에 대한 수정 요청 제출
4. **관리자 승인 확인**: 제출한 수정 요청의 승인/반려 상태 확인
5. **알림 설정**: 출근 시간 알림, 퇴근 시간 알림 개인 설정
6. **월별 근태 요약**: 해당 월의 근태 현황 요약 정보 확인

---

## 4. 기능 정의 (Feature Definition)
- **[FR-ATT-001] 출퇴근 기록**  
  - 수동 출퇴근 버튼 클릭
  - 위치 기반 출퇴근 (GPS 간단 확인)
  - 출퇴근 시간 기록 및 저장
  
- **[FR-ATT-002] 근무시간 계산**  
  - 일일 근무시간 자동 계산
  - 연장근무/야간근무 시간 구분
  - 휴게시간 차감 처리
  
- **[FR-ATT-003] 출퇴근 수정 요청**  
  - 누락/오류 기록 수정 요청
  - 관리자 승인 후 반영
  - 수정 이력 관리
  
- **[FR-ATT-004] 출퇴근 현황 조회**  
  - 개인별 출퇴근 기록 조회
  - 월별/주별 근무시간 통계
  - 지각/조퇴/결근 현황
---

## 5. UI/UX 요구사항
- 출퇴근 버튼: 크고 명확한 터치 버튼  
- 현재 상태 표시: 출근/퇴근 상태 명확 표시  
- 근무시간 표시: 실시간 근무시간 카운터  
- 위치 확인: GPS 기반 간단한 위치 확인  

---

## 6. 비즈니스 규칙
- 출근 후 퇴근 가능 (순서 보장)  
- 지각 기준: 정해진 출근시간 +10분  
- 조퇴 기준: 정해진 퇴근시간 -30분  
- 수정 요청은 관리자 승인 필요  

---

## 7. 데이터 모델링 (초안)
### attendances 테이블
| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| id | PK | 출퇴근 ID |
| employee_id | FK(employees.id) | 직원 |
| date | date | 근무일 |
| clock_in | datetime | 출근시간 |
| clock_out | datetime | 퇴근시간 |
| work_hours | int | 근무시간(분) |
| status | enum(normal, late, early) | 상태 |
| created_at | datetime | 생성일 |

---

## 8. 알림 및 연동
- 출퇴근 시 개인 알림  
- 지각/무단결근 시 관리자 알림  
- 급여 시스템 연동 (월말 정산)  

---

## 9. 예외 및 에러 처리
| 케이스 | 조건 | 시스템 동작 | 사용자 메시지 |
|--------|------|------------|--------------|
| 중복 출근 | 이미 출근 상태 | 차단 | "이미 출근 처리되었습니다." |
| 퇴근 전 출근 | 출근 없이 퇴근 | 차단 | "출근 기록이 없습니다." |
| 위치 오류 | GPS 범위 벗어남 | 경고 | "근무지 범위를 확인해주세요." |

---

## 10. 연관성 (Dependency & Integration)
- **일정 (prd_schedule.md)**: 근무일정과 출퇴근 시간 연계  
- **직원 (prd_employee.md)**: 직원별 근무 규칙 적용  
- **요청 (prd_request.md)**: 출퇴근 수정 요청 처리  
- **정산 (prd_payroll.md)**: 근무시간 데이터 제공  

---

## 11. 성공 지표 (KPI)
- 출퇴근 기록 성공률 ≥ 99%  
- 시스템 응답시간 ≤ 3초  
- 수정 요청 처리 시간 ≤ 24시간  