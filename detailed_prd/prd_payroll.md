# ClockBox - PRD 세부 문서 : 마감 및 정산 (Payroll)

## 1. 개요 (Overview)
ClockBox의 마감 및 정산(Payroll) 기능은 확정된 근무기록, 휴가, 연장/야간근로를 기반으로 급여 및 수당을 자동 산출하고, 명세서를 발송한다.

### 목적
- 급여 및 수당 계산 자동화  
- 근로기준법/최저임금 준수  
- 투명한 급여 지급 및 정산 기록 관리  

---

## 2. 사용자 시나리오 (User Flow)

### 시나리오 A: 월 마감 처리
1. 관리자가 월 마감 실행  
2. 해당 월 출퇴근/휴가/요청 데이터 확정  
3. 수정 불가 상태로 잠금 처리  

### 시나리오 B: 급여 정산
1. 마감 데이터 기반으로 급여 계산  
2. 연장/야간/휴일 수당 자동 반영  
3. 급여명세서 생성 및 발송  

### 시나리오 C: 정산 검증
1. 최저임금 및 주휴수당 자동 검증  
2. 기준 미달 시 관리자 알림  

---

## 3. 기능 정의 (Feature Definition)
- **[FR-PAY-001] 근무데이터 마감 처리**  
- **[FR-PAY-002] 급여/수당 정산 자동화**  
- **[FR-PAY-003] 주휴수당 및 최저임금 검증**  
- **[FR-PAY-004] 급여명세서 PDF 생성/발송**  
- **[FR-PAY-005] 정산 기록 보관/조회**  

---

## 4. UI/UX 요구사항
- 마감 실행 화면: 기간 선택, 진행률 표시  
- 정산 결과표: 직원별 근로시간/급여/수당 상세  
- 명세서 다운로드: PDF, Excel 지원  

---

## 5. 비즈니스 규칙
- 마감 후 데이터 수정 불가 (단, 관리자 override 가능)  
- 최저임금 자동 검증  
- 수당 계산은 근로기준법 규칙 자동 반영  
- 정산 기록 최소 5년 보관  

---

## 6. 데이터 모델링 (초안)
### payrolls 테이블
| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| id | PK | 정산 ID |
| company_id | FK(companies.id) | 회사 |
| period_start | datetime | 시작일 |
| period_end | datetime | 종료일 |
| total_hours | int | 총 근로시간 |
| overtime_hours | int | 연장근로 |
| holiday_hours | int | 휴일근로 |
| night_hours | int | 야간근로 |
| total_pay | int | 총 급여 |
| created_at | datetime | 생성일 |

### payslips 테이블
| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| id | PK | 명세서 ID |
| payroll_id | FK(payrolls.id) | 정산 ID |
| employee_id | FK(employees.id) | 직원 |
| base_pay | int | 기본급 |
| overtime_pay | int | 연장 수당 |
| holiday_pay | int | 휴일 수당 |
| night_pay | int | 야간 수당 |
| total_amount | int | 총액 |
| sent_at | datetime | 발송일 |

---

## 7. 알림 및 연동
- 마감 완료 시 관리자 알림  
- 급여명세서 발송 시 직원 알림  
- ERP/회계 시스템 연동 API 제공  

---

## 8. 예외 및 에러 처리
| 케이스 | 조건 | 시스템 동작 | 사용자 메시지 |
|--------|------|------------|--------------|
| 미마감 상태 정산 | 마감 처리 전 | 차단 | “마감 후 정산이 가능합니다.” |
| 근로시간 오류 | 출퇴근/휴가 데이터 불일치 | 검증 실패 | “근로시간 데이터 오류가 발생했습니다.” |
| 명세서 발송 실패 | 이메일/푸시 오류 | 재시도 | “급여명세서 발송에 실패했습니다. 다시 시도합니다.” |

---

## 9. 연관성 (Dependency & Integration)
- **출퇴근기록 (prd_attendance.md)**: 근로시간 데이터 반영  
- **휴가 (prd_leave.md)**: 유급/무급 반영  
- **요청 (prd_request.md)**: 승인된 변경 요청 반영  
- **리포트 (prd_report.md)**: 정산 데이터 보고서 제공  
- **메시지 (prd_message.md)**: 명세서 발송 알림  

---

## 10. 성공 지표 (KPI)
- 정산 오류율 ≤ 1%  
- 마감 처리 평균 시간 ≤ 10분  
- 명세서 발송 성공률 ≥ 99%  
