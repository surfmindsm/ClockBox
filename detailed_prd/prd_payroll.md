# ClockBox - PRD 세부 문서 : 마감 및 정산 (Payroll)

## 1. 개요 (Overview)
ClockBox의 마감 및 정산(Payroll) 기능은 확정된 근무기록, 휴가, 연장/야간근로를 기반으로 급여 및 수당을 자동 산출하고, 명세서를 발송한다.

### 목적
- 급여 및 수당 계산 자동화  
- 근로기준법/최저임금 준수  
- 투명한 급여 지급 및 정산 기록 관리  

---

## 2. 사용자 시나리오 (User Flow)

### 시나리오 A: AI 기반 지능형 급여 마감 및 예측 분석
1. **실시간 급여 예측 및 사전 검증**
   - AI 시스템이 월 중순부터 예상 급여 총액과 이상 징후 실시간 모니터링
   - 근로기준법 위반 가능성 사전 감지 및 자동 경고 (연장근로 한도 초과 등)
   - 예산 대비 급여 지출 예측 분석 및 비용 최적화 제안
   - 개별 직원의 급여 변동 패턴 분석으로 이상 케이스 자동 식별
2. **지능형 자동 마감 프로세스**
   - 블록체인 기반 데이터 무결성 검증으로 변조 방지 마감 처리
   - 머신러닝 알고리즘으로 과거 마감 패턴 학습하여 최적 마감 시점 추천
   - 다중 검증 단계를 통한 Zero-error 마감 시스템
   - 마감 후 즉시 모든 이해관계자에게 개인화된 요약 보고서 자동 발송
3. **실시간 감사 로그 및 컴플라이언스 추적**
   - 모든 마감 과정을 블록체인에 기록하여 완전한 감사 증적 제공
   - 실시간 규정 준수 상태 모니터링 및 위험도 평가
   - 자동 백업 및 재해 복구 시스템으로 데이터 손실 제로 보장

### 시나리오 B: 차세대 스마트 급여 정산 시스템
1. **다차원 급여 계산 엔진**
   - 50개 이상 급여 구성요소 동시 처리 (기본급, 각종 수당, 인센티브, 공제 등)
   - AI 기반 급여 정책 해석으로 복잡한 단체협약 규정 자동 적용
   - 실시간 환율 반영으로 해외 근무자 급여 자동 계산
   - 프로젝트 기여도 분석을 통한 성과급 자동 배분 시스템
2. **지능형 예외 처리 및 자동 조정**
   - 이상 급여 패턴 자동 감지 및 원인 분석 (급여 급등/급락)
   - 세법 변경사항 실시간 반영 및 소급 적용 자동 처리
   - 개별 직원 상황 맞춤형 급여 조정 (육아휴직, 병가, 특별휴가 등)
   - 급여 분쟁 발생 시 자동 중재 프로세스 및 증빙 자료 수집
3. **블록체인 기반 투명한 급여 지급**
   - 스마트 컨트랙트 기반 급여 자동 지급으로 인적 오류 완전 제거
   - 각 직원별 급여 계산 과정 투명 공개 (개인정보 보호하에)
   - 암호화폐 지급 옵션 제공으로 글로벌 직원 즉시 송금
   - 급여 지급 내역의 불변 기록 보존으로 완전한 투명성 확보

### 시나리오 C: 글로벌 멀티-쥬리스딕션 규정 준수 자동화
1. **AI 기반 실시간 규정 준수 모니터링**
   - 전세계 200개국 노동법 실시간 업데이트 및 자동 적용
   - 최저임금, 연장근로, 휴가 규정 등 복합 규정 동시 검증
   - 규정 위반 위험도 실시간 계산 및 예방적 조치 자동 실행
   - 다국가 기업의 법인별/지역별 차등 규정 자동 관리
2. **예측 기반 컴플라이언스 관리**
   - 향후 3개월 규정 위반 가능성 예측 및 사전 대응책 제시
   - 정부 정책 변화 트렌드 분석으로 규정 변경 사전 준비
   - 업종별/규모별 벤치마킹을 통한 컴플라이언스 수준 비교 분석
   - 자동 규정 준수 보고서 생성 및 관련 기관 제출 자동화
3. **지능형 감사 준비 시스템**
   - 정부 감사/조사 대응 자료 자동 수집 및 정리
   - 감사 항목별 위험도 평가 및 우선순위 대응 가이드 제공
   - 과거 감사 이력 학습을 통한 맞춤형 대응 전략 수립
   - 실시간 컴플라이언스 대시보드로 경영진 투명 보고

### 시나리오 D: 개인화된 직원 급여 포털 및 재무 어드바이저
1. **AI 기반 개인 재무 관리 어시스턴트**
   - 개별 직원의 급여 패턴 분석을 통한 재무 계획 수립 지원
   - 세금 최적화 방안 및 절세 전략 개인 맞춤 제안
   - 퇴직연금, 보험, 투자 상품 개인별 추천 시스템
   - 급여 사용 패턴 분석으로 저축 목표 달성 가이드 제공
2. **실시간 급여 투명성 및 상호작용**
   - 급여 계산 과정 실시간 시각화 및 구성요소별 상세 설명
   - 가상현실 환경에서 급여 데이터 3D 탐색 및 분석
   - 동료 대비 급여 수준 익명 벤치마킹 (개인정보 보호)
   - 챗봇을 통한 급여 관련 질문 24/7 자동 답변
3. **미래 급여 시뮬레이션 및 경력 계획**
   - 승진, 이직, 교육 이수에 따른 급여 변화 시뮬레이션
   - 업계 트렌드 분석을 통한 장기 급여 전망 제공
   - 개인 역량 개발 계획과 연계한 급여 상승 로드맵 제시
   - 라이프 이벤트(결혼, 육아, 주택구입)별 급여 계획 최적화

### 시나리오 E: 차세대 급여 분석 및 조직 인사이트
1. **빅데이터 기반 급여 트렌드 분석**
   - 수백만 건의 급여 데이터에서 숨겨진 패턴 및 인사이트 발견
   - 업종별/지역별/직급별 급여 벤치마킹 및 경쟁력 분석
   - 급여 만족도와 이직률 상관관계 분석으로 최적 급여 구조 제안
   - 성과와 급여 연계성 분석을 통한 공정한 보상 체계 설계
2. **예측 분석 기반 인력 관리 최적화**
   - 급여 데이터 기반 이직 가능성 예측 및 retention 전략 수립
   - 급여 효율성 분석을 통한 조직 구조 최적화 제안
   - 시장 급여 트렌드 예측으로 예산 계획 수립 지원
   - 급여 격차 분석을 통한 DEI(다양성, 형평성, 포용성) 개선
3. **경영진 전략적 의사결정 지원**
   - 급여 정책 변경에 따른 비즈니스 임팩트 시뮬레이션
   - 인건비 최적화와 직원 만족도 균형점 자동 탐색
   - 글로벌 급여 정책 통합 및 현지화 전략 수립 지원
   - 급여 관련 ESG 지표 관리 및 지속가능경영 보고  

---

## 3. 기능 정의 (Feature Definition)
- **[FR-PAY-001] 근무데이터 마감 처리**  
- **[FR-PAY-002] 급여/수당 정산 자동화**  
- **[FR-PAY-003] 주휴수당 및 최저임금 검증**  
- **[FR-PAY-004] 급여명세서 PDF 생성/발송**  
- **[FR-PAY-005] 정산 기록 보관/조회**  

---

## 4. UI/UX 요구사항
- 마감 실행 화면: 기간 선택, 진행률 표시  
- 정산 결과표: 직원별 근로시간/급여/수당 상세  
- 명세서 다운로드: PDF, Excel 지원  

---

## 5. 비즈니스 규칙
- 마감 후 데이터 수정 불가 (단, 관리자 override 가능)  
- 최저임금 자동 검증  
- 수당 계산은 근로기준법 규칙 자동 반영  
- 정산 기록 최소 5년 보관  

---

## 6. 데이터 모델링 (초안)
### payrolls 테이블
| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| id | PK | 정산 ID |
| company_id | FK(companies.id) | 회사 |
| period_start | datetime | 시작일 |
| period_end | datetime | 종료일 |
| total_hours | int | 총 근로시간 |
| overtime_hours | int | 연장근로 |
| holiday_hours | int | 휴일근로 |
| night_hours | int | 야간근로 |
| total_pay | int | 총 급여 |
| created_at | datetime | 생성일 |

### payslips 테이블
| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| id | PK | 명세서 ID |
| payroll_id | FK(payrolls.id) | 정산 ID |
| employee_id | FK(employees.id) | 직원 |
| base_pay | int | 기본급 |
| overtime_pay | int | 연장 수당 |
| holiday_pay | int | 휴일 수당 |
| night_pay | int | 야간 수당 |
| total_amount | int | 총액 |
| sent_at | datetime | 발송일 |

---

## 7. 알림 및 연동
- 마감 완료 시 관리자 알림  
- 급여명세서 발송 시 직원 알림  
- ERP/회계 시스템 연동 API 제공  

---

## 8. 예외 및 에러 처리
| 케이스 | 조건 | 시스템 동작 | 사용자 메시지 |
|--------|------|------------|--------------|
| 미마감 상태 정산 | 마감 처리 전 | 차단 | “마감 후 정산이 가능합니다.” |
| 근로시간 오류 | 출퇴근/휴가 데이터 불일치 | 검증 실패 | “근로시간 데이터 오류가 발생했습니다.” |
| 명세서 발송 실패 | 이메일/푸시 오류 | 재시도 | “급여명세서 발송에 실패했습니다. 다시 시도합니다.” |

---

## 9. 연관성 (Dependency & Integration)
- **출퇴근기록 (prd_attendance.md)**: 근로시간 데이터 반영  
- **휴가 (prd_leave.md)**: 유급/무급 반영  
- **요청 (prd_request.md)**: 승인된 변경 요청 반영  
- **리포트 (prd_report.md)**: 정산 데이터 보고서 제공  
- **메시지 (prd_message.md)**: 명세서 발송 알림  

---

## 10. 성공 지표 (KPI)
- 정산 오류율 ≤ 1%  
- 마감 처리 평균 시간 ≤ 10분  
- 명세서 발송 성공률 ≥ 99%  
