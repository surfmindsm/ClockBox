# ClockBox - PRD 세부 문서 : 전자계약 (Contract)

## 1. 개요 (Overview)
ClockBox의 전자계약(Contract) 기능은 근로계약서, 연차촉진제 문서, 근무조건 변경 계약 등을 전자서명 기반으로 안전하게 관리한다.

### 목적
- 법적 효력 있는 전자계약 관리  
- 계약 이력 추적 및 보관  
- 관리자-직원 간 효율적인 계약 프로세스 제공  

---

## 2. 사용자 시나리오 (User Flow)

### 시나리오 A: 근로계약 체결
1. 관리자가 템플릿 선택 → 계약 생성  
2. 직원 지정 → 전송  
3. 직원이 앱에서 확인 후 전자서명  
4. 계약 완료 → 자동 보관 및 알림 발송  

### 시나리오 B: 계약 갱신
1. 계약 만료 30일 전 알림 발송  
2. 관리자가 계약 갱신 생성  
3. 직원 서명 후 갱신 완료  

---

## 3. 기능 정의 (Feature Definition)
### 핵심 기능
- **[FR-CON-001] 고급 계약 템플릿 관리**
  - 마크다운/리치텍스트 지원
  - 동적 필드 삽입 (직원명, 급여, 입사일 등)
  - 템플릿 버전 관리 및 승인 워크플로우
  - 카테고리별 템플릿 분류 (근로계약, 변경계약, 특별계약 등)
- **[FR-CON-002] 스마트 계약 전송 시스템**
  - 개별/일괄 전송 지원
  - 전송 예약 기능
  - 대상 직원 필터링 (부서, 직급, 입사일 기준)
- **[FR-CON-003] 다단계 전자서명**
  - 법적 효력 보장 (KISA 인증)
  - 생체 인증 연동 (지문, 얼굴 인식)
  - 서명 위치 커스터마이징
  - 서명 검증 및 위변조 방지
- **[FR-CON-004] 포괄적 계약 이력 관리**
  - 계약 갱신/변경 추적
  - 버전별 비교 기능
  - 이력 타임라인 시각화
- **[FR-CON-005] 지능형 계약 검색/관리**
  - 전문 검색 (기간, 직원, 계약 유형)
  - 만료 예정 계약 자동 알림
  - 대시보드 통계 제공

### 고급 기능
- **[FR-CON-006] 계약 승인 워크플로우**
- **[FR-CON-007] 감사 추적 및 컴플라이언스**
- **[FR-CON-008] 다국어 계약 지원**
- **[FR-CON-009] 외부 시스템 연동 (HR, 급여)**  

---

## 4. UI/UX 요구사항
### 관리자 인터페이스
- **계약 생성 마법사**: 단계별 안내 (템플릿 선택 → 내용 편집 → 대상 선택 → 전송)
- **고급 텍스트 편집기**: 
  - WYSIWYG 편집기
  - 동적 필드 드래그 앤 드롭
  - 실시간 미리보기
  - 변수 자동완성 기능
- **대시보드 개요**: 
  - 계약 상태 시각화 (원형/막대 차트)
  - 만료 임박 계약 알림
  - 최근 활동 타임라인

### 직원 인터페이스
- **모바일 최적화 서명 화면**: 
  - 터치 서명 지원
  - 확대/축소 기능
  - 서명 위치 가이드라인
- **계약 열람 화면**:
  - 전체 화면 읽기 모드
  - 중요 조항 하이라이트
  - 용어 설명 툴팁
- **계약 이력 조회**: 
  - 개인 계약 타임라인
  - PDF 다운로드 기능

### 공통 요구사항
- **다크 모드 지원**
- **반응형 디자인** (모바일, 태블릿, 데스크톱)
- **접근성 준수** (WCAG 2.1 AA 수준)
- **다국어 지원** (한국어, 영어)  

---

## 5. 비즈니스 규칙
### 권한 및 접근 제어
- **계약 생성 권한**: 
  - 관리자(Admin) 및 인사담당자(HR) 역할만 가능
  - 부서별 제한 권한 설정 가능 (부서장은 해당 부서만)
- **템플릿 관리 권한**: 
  - 슈퍼 관리자만 공통 템플릿 수정 가능
  - 부서별 템플릿은 해당 부서 관리자 수정 가능
- **열람 권한**: 
  - 직원은 본인 계약서만 열람
  - 관리자는 소속 직원 계약서 열람
  - 감사 역할은 모든 계약서 읽기 전용 접근

### 보안 및 컴플라이언스
- **전자서명 요구사항**:
  - KISA(한국인터넷진흥원) 전자서명법 준수
  - PKI 기반 공인인증서 또는 생체 인증 지원
  - 서명 시점의 IP 주소, 디바이스 정보 기록
- **데이터 보관 정책**:
  - 계약 이력 최소 7년 보관 (근로기준법 준수)
  - 삭제 요청 시에도 법정 보관기간까지 익명화 보관
  - 자동 백업 및 복구 시스템 운영
- **감사 추적**:
  - 모든 계약 관련 활동 로그 기록
  - 변경 이력, 접근 기록, 서명 과정 추적
  - 외부 감사 요청 시 보고서 자동 생성

### 계약 생명주기 관리
- **자동화 규칙**:
  - 만료 30일 전 관리자에게 알림
  - 만료 7일 전 직원에게 알림
  - 만료 후 자동으로 expired 상태 변경
- **승인 워크플로우**:
  - 고액 계약(연봉 기준) 다단계 승인 필요
  - 특수 조항 포함 시 법무팀 검토 필수
  - 승인자 부재 시 대행자 자동 지정  

---

## 6. 데이터 모델링 (초안)
### contracts 테이블
| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| id | PK | 계약 ID |
| company_id | FK(companies.id) | 회사 |
| employee_id | FK(employees.id) | 직원 |
| template_id | FK(contract_templates.id) | 템플릿 |
| status | enum(pending, signed, expired) | 상태 |
| signed_at | datetime | 서명일 |
| created_at | datetime | 생성일 |

### contract_templates 테이블
| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| id | PK | 템플릿 ID |
| company_id | FK(companies.id) | 회사 |
| name | string | 템플릿명 |
| content | text | 내용 |
| created_at | datetime | 생성일 |

---

## 7. 알림 및 연동
### 스마트 알림 시스템
- **실시간 푸시 알림**:
  - 계약 전송 시 직원에게 즉시 알림
  - 서명 완료 시 관리자에게 즉시 알림
  - 만료 임박 계약 자동 알림 (30일, 7일, 1일 전)
- **이메일 알림**:
  - 계약서 PDF 첨부 발송
  - HTML 형태의 요약 정보 포함
  - 맞춤형 메시지 템플릿 지원
- **SMS/카카오톡 알림**:
  - 긴급 계약 서명 요청
  - 서명 완료 확인 메시지
  - 만료 경고 알림

### 외부 시스템 연동
- **전자서명 서비스**:
  - KISA 인증 서비스 (공인인증서)
  - DocuSign API 연동
  - 카카오페이 인증 연동
  - PASS 앱 생체 인증 연동
- **HR 시스템 연동**:
  - 인사정보 자동 동기화
  - 조직도 변경 시 권한 자동 업데이트
  - 급여 시스템과 계약 조건 연동
- **회계/ERP 연동**:
  - 계약 조건 기반 급여 정산
  - 비용 센터별 계약 분류
  - 예산 관리 시스템과 연결
- **클라우드 저장소 연동**:
  - Google Drive, OneDrive 자동 백업
  - 계약서 PDF 자동 업로드
  - 폴더 구조 자동 생성 (연도/부서별)  

---

## 8. 예외 및 에러 처리
| 케이스 | 조건 | 시스템 동작 | 사용자 메시지 |
|--------|------|------------|--------------|
| 미서명 계약 만료 | 기간 경과 | expired 처리 | "계약이 만료되었습니다." |
| 템플릿 삭제 | 전송 시 템플릿 없음 | 전송 차단 | "계약 템플릿이 유효하지 않습니다." |
| 서명 거부 | 직원이 거부 선택 | 계약 상태 rejected | "계약이 거부되었습니다." |
| 전자서명 인증 실패 | 인증서 오류 | 서명 차단 | "전자서명 인증에 실패했습니다. 인증서를 확인해주세요." |
| 권한 없는 계약 접근 | 무권한 사용자 접근 | 접근 차단 | "해당 계약에 접근할 권한이 없습니다." |
| 동시 편집 충돌 | 여러 관리자가 동시 수정 | 버전 충돌 알림 | "다른 사용자가 편집 중입니다. 잠시 후 다시 시도해주세요." |
| 대용량 파일 업로드 실패 | 파일 크기 초과 | 업로드 차단 | "파일 크기가 너무 큽니다. (최대 10MB)" |
| 외부 서명 서비스 장애 | API 응답 없음 | 대체 서비스 제안 | "전자서명 서비스에 일시적 장애가 있습니다. 다른 방법을 시도해주세요." |

## 8-1. 컴플라이언스 및 감사 기능
### 법적 요구사항 준수
- **근로기준법 준수 체크**:
  - 최저임금 기준 자동 검증
  - 근무시간 상한선 체크
  - 필수 계약 조항 포함 여부 확인
- **개인정보보호법 준수**:
  - 민감정보 처리 동의 확인
  - 개인정보 수집/이용 목적 명시
  - 보관 기간 자동 관리

### 감사 추적 시스템
- **상세 활동 로그**:
  - 계약 생성/수정/삭제 이력
  - 서명 과정의 모든 단계 기록
  - IP 주소, 디바이스 정보, 시간 기록
- **감사 보고서 자동 생성**:
  - 월간/분기/연간 계약 통계
  - 컴플라이언스 준수 현황
  - 리스크 분석 및 권고사항
- **외부 감사 지원**:
  - 감사 요청 시 필요 문서 자동 추출
  - 익명화된 데이터 제공 기능
  - 감사 과정 추적 및 기록

---

## 9. 연관성 (Dependency & Integration)
- **직원 (prd_employee.md)**: 계약 대상 지정  
- **메시지 (prd_message.md)**: 계약 전송/완료 알림 발송  
- **회사설정 (prd_company.md)**: 계약 보관 정책 관리  

---

## 10. 성공 지표 (KPI)
### 운영 효율성 지표
- **계약 프로세스 효율성**:
  - 계약 전송 → 서명 완료율 ≥ 95%
  - 평균 서명 완료 시간 ≤ 24시간
  - 계약 생성 시간 ≤ 5분 (템플릿 사용 시)
- **시스템 성능 지표**:
  - 계약 보관 검색 응답 속도 ≤ 3초
  - 시스템 가용성 ≥ 99.9%
  - 동시 접속자 500명 지원

### 사용자 만족도 지표
- **사용성 평가**:
  - 관리자 만족도 ≥ 4.5/5.0
  - 직원 서명 과정 만족도 ≥ 4.0/5.0
  - 고객 지원 문의 감소율 ≥ 30%
- **기능 활용률**:
  - 템플릿 사용률 ≥ 80%
  - 모바일 서명 비율 ≥ 60%
  - 자동 알림 오픈률 ≥ 70%

### 컴플라이언스 지표
- **법적 준수율**:
  - 계약서 법적 요건 충족률 100%
  - 감사 요청 대응 시간 ≤ 1일
  - 개인정보 보호 위반 사고 0건
- **보안 지표**:
  - 전자서명 위변조 시도 탐지율 100%
  - 무권한 접근 차단율 100%
  - 데이터 백업 성공률 100%  
