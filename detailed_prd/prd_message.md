# ClockBox - PRD 세부 문서 : 메시지 (Message)

## 1. 개요 (Overview)
ClockBox의 메시지(Message) 기능은 관리자와 직원 간의 소통, 근태/요청/정산 관련 알림, 공지사항 발송을 위한 커뮤니케이션 채널을 제공한다.

### 목적
- 전사 소통의 효율화
- 근태/정산/요청 관련 자동 알림
- 모든 커뮤니케이션 로그의 투명한 보관

---

## 2. 사용자 시나리오 (User Flow)

### 시나리오 A: 공지사항 발송
1. 관리자가 메시지 작성 → 대상 조직/직원 선택  
2. 공지 발송 → 전 직원 알림  
3. 읽음 여부 통계 확인 가능  

### 시나리오 B: 근태 알림
1. 직원이 지각 기록 발생  
2. 시스템이 자동으로 알림 발송  
3. 관리자는 대시보드에서 지각 현황 확인  

### 시나리오 C: 급여명세서 발송
1. 급여 정산 완료 후  
2. 직원별 급여명세서 메시지 발송  
3. 직원이 앱에서 확인/다운로드  

---

## 3. 기능 정의 (Feature Definition)
- **[FR-MSG-001] 공지사항 발송 (조직/직원 대상 지정 가능)**  
- **[FR-MSG-002] 근태 알림 (지각/결근/무일정 등 자동 발송)**  
- **[FR-MSG-003] 요청 알림 (승인/반려 결과 알림)**  
- **[FR-MSG-004] 급여명세서 발송 (정산 시스템 연동)**  
- **[FR-MSG-005] 메시지 로그/읽음 확인**  

---

## 4. UI/UX 요구사항
- 메시지 작성기: 리치 텍스트, 파일 첨부 지원  
- 수신자 선택: 조직/개별 직원 단위 지정 가능  
- 메시지함: 공지, 알림, 명세서 구분 탭 제공  
- 읽음/미확인 상태 표시 및 필터링  

---

## 5. 비즈니스 규칙
- 공지사항은 관리자만 발송 가능  
- 근태/요청/정산 알림은 시스템 자동 발송  
- 메시지 로그는 최소 1년 보관  

---

## 6. 데이터 모델링 (초안)
### messages 테이블
| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| id | PK | 메시지 ID |
| sender_id | FK(employees.id) | 발신자 |
| recipient_id | FK(employees.id) | 수신자 |
| type | enum(notice, attendance, request, payroll) | 메시지 유형 |
| content | text | 메시지 내용 |
| attachment_url | string | 첨부파일 |
| read_at | datetime | 읽은 시간 |
| created_at | datetime | 생성일 |

---

## 7. 알림 및 연동
- 모바일 푸시/이메일 연동  
- Slack/MS Teams/카카오워크 연동  

---

## 8. 예외 및 에러 처리
| 케이스 | 조건 | 시스템 동작 | 사용자 메시지 |
|--------|------|------------|--------------|
| 수신자 없음 | 대상 지정 X | 발송 차단 | “수신자를 지정해주세요.” |
| 알림 실패 | 네트워크 오류 | 재시도 | “메시지 전송 실패, 다시 시도합니다.” |

---

## 9. 연관성 (Dependency & Integration)
- **요청 (prd_request.md)**: 요청 승인/반려 알림 발송  
- **정산 (prd_payroll.md)**: 급여명세서 알림  
- **휴가/출퇴근 (prd_leave.md, prd_attendance.md)**: 근태 알림 발송  
- **회사설정 (prd_company.md)**: 메시지/알림 정책 연동  

---

## 10. 성공 지표 (KPI)
- 메시지 발송 성공률 ≥ 99%  
- 공지사항 확인율 ≥ 90%  
- 알림 처리 지연 시간 ≤ 3초  
