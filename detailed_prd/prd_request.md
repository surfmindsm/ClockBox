# ClockBox - PRD 세부 문서 : 요청 (Request)

## 1. 개요 (Overview)
ClockBox의 요청(Request) 기능은 직원이 근무 관련 데이터(근무일정, 출퇴근기록, 휴가 등)를 변경하거나 보완해야 할 때, 관리자의 승인 절차를 통해 투명하게 반영하는 워크플로우를 제공한다.

### 목적
- 근태/일정/휴가 등 주요 데이터 변경의 **투명성 확보**
- 승인 라인 및 규칙 기반의 **권한 관리**
- 요청/승인 데이터의 **정산 및 리포트 연동**

---

## 2. 사용자 시나리오 (User Flow)

### 시나리오 A: 출퇴근 누락 요청
1. 직원이 출근 기록이 누락된 것을 확인  
2. 앱에서 “출퇴근 누락 요청” 생성 (날짜, 시간, 사유 입력)  
3. 관리자에게 알림 발송 → 관리자 승인  
4. 승인 시 출퇴근기록 DB 반영, 리포트/정산 자동 갱신  

### 시나리오 B: 근무일정 변경 요청
1. 직원이 개인 사정으로 일정 변경 필요  
2. 앱에서 변경 요청 생성 (변경 전/후 시간, 사유 입력)  
3. 관리자 승인 후 근무일정 반영  
4. 스케줄 충돌 시 경고 및 반려 가능  

### 시나리오 C: 휴가 취소 요청
1. 이미 승인된 휴가를 취소 요청  
2. 관리자 승인 시 휴가/일정/정산 반영  
3. 반려 시 사유 전달  

---

## 3. 기능 정의 (Feature Definition)
- **[FR-REQ-001] 요청 생성/수정/삭제**  
- **[FR-REQ-002] 승인 라인 관리 (1차/2차 승인 지원)**  
- **[FR-REQ-003] 자동 승인 규칙 (예: 30분 이내 출퇴근 누락 자동 승인)**  
- **[FR-REQ-004] 커스텀 요청 유형 등록 (예: 증명서 발급, 비용 처리)**  
- **[FR-REQ-005] 요청 이력 관리 (추적/감사 로그)**  

---

## 4. UI/UX 요구사항
- 요청 생성 화면: 요청 유형, 세부 내용, 사유 입력  
- 승인 화면: 승인/반려 버튼, 코멘트 입력  
- 요청 리스트: 대기/승인/반려 상태 표시, 필터링 지원  
- 요청 상세: 요청 이력, 승인자, 처리일 표시  

---

## 5. 비즈니스 규칙
- 모든 요청은 **승인 라인**을 반드시 거쳐야 함  
- 승인자 부재 시 대리 승인 가능 (회사 정책 설정에 따름)  
- 요청은 승인 전까지만 수정/삭제 가능  
- 요청 데이터는 정산/리포트와 반드시 연동됨  

---

## 6. 데이터 모델링 (초안)
### requests 테이블
| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| id | PK | 요청 ID |
| employee_id | FK(employees.id) | 요청자 |
| type | enum(schedule, attendance, leave, custom) | 요청 유형 |
| payload | json | 요청 상세 데이터 |
| status | enum(pending, approved, rejected) | 상태 |
| approver_id | FK(employees.id) | 승인자 |
| created_at | datetime | 생성일 |
| resolved_at | datetime | 처리일 |

### request_logs 테이블
| 컬럼명 | 타입 | 설명 |
|--------|------|------|
| id | PK | 로그 ID |
| request_id | FK(requests.id) | 요청 ID |
| action | enum(created, updated, approved, rejected, deleted) | 활동 유형 |
| actor_id | FK(employees.id) | 수행자 |
| comment | text | 코멘트 |
| timestamp | datetime | 시간 |

---

## 7. 알림 및 연동
- 요청 생성 시 관리자 푸시/메일 알림  
- 승인/반려 시 직원 알림  
- 메시지 시스템과 연동하여 “요청 승인/반려 결과” 발송  

---

## 8. 예외 및 에러 처리
| 케이스 | 조건 | 시스템 동작 | 사용자 메시지 |
|--------|------|------------|--------------|
| 승인자 없음 | 승인 라인 미설정 | 요청 차단 | “승인자를 지정해야 합니다.” |
| 중복 요청 | 동일 기간에 동일 요청 존재 | 차단 | “이미 요청된 건이 있습니다.” |
| 승인 지연 | 7일 이상 미처리 | 자동 알림 | “요청이 아직 처리되지 않았습니다.” |
| 요청 취소 불가 | 승인 완료 상태 | 차단 | “승인된 요청은 취소할 수 없습니다.” |

---

## 9. 연관성 (Dependency & Integration)
- **출퇴근기록 (prd_attendance.md)**: 누락/수정 요청 반영  
- **근무일정 (prd_schedule.md)**: 일정 변경 요청 반영  
- **휴가 (prd_leave.md)**: 휴가 취소/변경 요청 반영  
- **메시지 (prd_message.md)**: 요청 알림/승인 결과 발송  
- **정산 (prd_payroll.md)**: 승인된 요청 데이터 정산 반영  

---

## 10. 성공 지표 (KPI)
- 요청 처리 평균 시간 ≤ 24시간  
- 자동 승인 처리 비율 ≥ 30%  
- 요청 관련 분쟁 발생률 ≤ 1%  
